# Part of the ptxparser project
#
# SPDX-FileCopyrightText: 2023 2021 University of Rochester
# SPDX-License-Identifier: LGPL-3.0-or-later

CVT2BNF = cvt2bnf.py
TARGET ?= build

all: $(TARGET) $(TARGET)/ptx_grammar.bnf

$(TARGET):
	mkdir -p $(TARGET)

$(TARGET)/ptx_grammar.bnf: $(TARGET)/ptx_grammar.txt ptx_tokens.txt
	$(CVT2BNF) $^ > $@
	./nametokens.py ptx_tokens.txt
	$(CVT2BNF) $^ > $@ # to have the new names generated by nametokens to take effect

$(TARGET)/ptx_grammar.txt: ptx65_opcodes.txt ptx_expressions.txt gen_ptx_grammar.py
	./gen_ptx_grammar.py ptx65_opcodes.txt ptx_expressions.txt  $@

